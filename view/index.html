<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{{config.title}}</title>
    <link rel="stylesheet" href="{{config.staticUrl.layuiCSSPath}}">
</head>
<style>
    pre {
        padding: 15px;
        margin: 5px;
        font-size: 15px;
        line-height: 23px;
    }

    .string {
        color: red;
    }

    .number {
        color: green;
    }

    .boolean {
        color: blue;
    }

    .null {
        color: yellow;
    }

    .key {
        color: black;
    }
</style>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <a href="/doc/index.php">
                <div class="layui-logo">{{config.title}}</div>
            </a>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item">
                    <a href="javascript:;">{{config.defaultModule}}</a>
                    <dl class="layui-nav-child">
                        {% for module in availableModule %}
                        {% if module == config.defaultModule %}
                        <dd class="layui-this"><a href="/doc/index.php?module={{module}}" .'">{{module}}</a></dd>
                        {% else %}
                        <dd><a href="/doc/index.php?module={{module}}">{{module}}</a></dd>
                        {% endif%}
                        {% endfor %}
                    </dl>
                </li>
            </ul>
        </div>
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    {% for class in classList %}
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;" onclick="showClassDesc('{{classDoc}}', this);">
                            {{class.className}}
                        </a>
                        <dl class="layui-nav-child">
                            {% for doc in class.docList %}
                            {% if class.module == config.defaultModule and class.className == config.defaultClass and doc.method == config.defaultMethod %}
                            <dd class='layui-this'><a
                                    href='/doc/index.php?module={{class.module}}&class={{class.className}}&method={{doc.method}}'>{{doc.method}}</a>
                            </dd>
                            {% else %}
                            <dd><a
                                    href='/doc/index.php?module={{class.module}}&class={{class.className}}&method={{doc.method}}'>{{doc.method}}</a>
                            </dd>
                            {% endif %}
                            {% endfor %}
                        </dl>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="layui-body">
            <button style="bottom: 100px;" type="button"
                class="layui-btn layui-btn-danger layui-btn-radius layui-fixbar"
                onclick="openRequestFrame();">请求测试</button>
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">
                {% if methodDoc.description %}
                <blockquote class="layui-elem-quote">说明: {{methodDoc.description}}</blockquote>
                {% endif %}
                <blockquote class="layui-elem-quote">标题: {{methodDoc.summary}}</blockquote>
                <blockquote class="layui-elem-quote">请求链接: {{requestUrl}}</blockquote>

                {% if methodDoc.params %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>请求参数</legend>
                </fieldset>
                <div class="layui-form">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                <th>参数名</th>
                                <th>类型</th>
                                <th>是否可选</th>
                                <th>默认值</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param in methodDoc.params %}
                            <tr>
                                <td>{{param['name']}}</td>
                                <td>{{param['type']}}</td>
                                <td>{{param['default']}}</td>
                                <td>{{param['defaultValue']}}</td>
                                <td>{{param['desc']}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% if methodDoc.requestExample %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>请求示例</legend>
                </fieldset>
                <div class="layui-tab layui-tab-card">
                    <ul class="layui-tab-title">
                        {% for key, example in methodDoc.requestExample %}
                        <li {% if key == 0 %}class="layui-this" {% endif %}>{% if key == 0 %}默认{% else %}示例 -
                            {{key}}{% endif %}</li>
                        {% endfor %}
                    </ul>
                    <div class="layui-tab-content">
                        {% for key, example in methodDoc.requestExample %}
                        <div class="layui-tab-item {% if key == 0 %}layui-show{% endif %}">
                            <input type="hidden" name="requestExample" value="{{example}}">
                            <pre id="requestExampleValue{{key}}"></pre>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if methodDoc.resParams %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>返回字段说明</legend>
                </fieldset>
                <div class="layui-form">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                <th>参数名</th>
                                <th>类型</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param in methodDoc.resParams %}
                            <tr>
                                <td>{{param['name']}}</td>
                                <td>{{param['type']}}</td>
                                <td>{{param['desc']}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% if methodDoc.returnExample %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>返回示例</legend>
                </fieldset>
                <div class="layui-tab layui-tab-card">
                    <ul class="layui-tab-title">
                        {% for key, example in methodDoc.returnExample %}
                        <li {% if key == 0 %}class="layui-this" {% endif %}>{% if key == 0 %}默认{% else %}示例 -
                            {{key}}{% endif %}</li>
                        {% endfor %}
                    </ul>
                    <div class="layui-tab-content">
                        {% for key, example in methodDoc.returnExample %}
                        <div class="layui-tab-item {% if key == 0 %}layui-show{% endif %}">
                            <input type="hidden" name="returnExample" value="{{example}}">
                            <pre id="returnExampleValue{{key}}"></pre>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if methodDoc.table %}
                {% for table in methodDoc.table %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>{{table.title}}</legend>
                </fieldset>
                <div class="layui-form">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                {% for th in table.thead %}
                                <th>{{th}}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for tdArr in table.body %}
                            <tr>
                                {% for td in tdArr %}
                                <td>{{td}}</td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endfor %}
                {% endif %}

                {% if methodDoc.link %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>参考链接</legend>
                </fieldset>
                {% for link in methodDoc.link %}
                <blockquote class="layui-elem-quote"><a href="{{link}}" target="_blank">{{link}}</a></blockquote>
                {% endfor %}
                {% endif %}

                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                    <legend>接口发展时间线</legend>
                </fieldset>
                <ul class="layui-timeline">
                    {% for log in methodDoc.changeLog %}
                    <li class="layui-timeline-item">
                        <i class="layui-icon layui-timeline-axis"></i>
                        <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title">{{log.event}}</h3>
                            <p>{{log.time}} &nbsp;&nbsp;||&nbsp;&nbsp; {{log.author}}</p>
                        </div>
                    </li>
                    {% endfor %}
                    <li class="layui-timeline-item">
                        <i class="layui-icon layui-timeline-axis"></i>
                        <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title">创建接口</h3>
                            <p>{{methodDoc.since}} &nbsp;&nbsp;||&nbsp;&nbsp; {{methodDoc.author}}</p>
                        </div>
                    </li>
                </ul>

                <div id="formContent" style="display:none;">
                    {% include 'request.html' %}
                </div>
            </div>
        </div>

        <div class="layui-footer" style="align-content: center;">
            <a href="https://github.com/sunanzhi/annotatedDoc" target="_blank" rel="nofollow">© MorsTiin Doc MIT License
                &nbsp;&nbsp;||&nbsp;&nbsp; GitHub</a>
            <a style="float: right;" href="http://www.miitbeian.gov.cn/" target="_blank"
                rel="nofollow">{{config.miitbeian}}</a>
        </div>
    </div>
    <input type="hidden" value="{{methodDoc['example']['requestExample']}}" id="requestExampleVal">
    <input type="hidden" value="{{methodDoc['example']['returnExample']}}" id="returnExampleVal">
    <script src="{{config.staticUrl.jqueryPath}}"></script>
    <script src="{{config.staticUrl.layuiJsPath}}"></script>
    <script>
        // https://www.layui.com/demo/layuiAdmin.html 后台模版示例文档
        //JavaScript代码区域
        layui.use('element', function () {
            var element = layui.element;
        });
        layui.use(['form', 'layer'], function () {
            var form = layui.form;

            // 新增header内容
            form.on('submit(addHeaderSection)', function (data) {
                $(data.form).find("#headerSeparator").before(
                    '<div class="layui-form-item">' +
                    '<div class="layui-inline">' +
                    '<label class="layui-form-label">key</label>' +
                    '<div class="layui-input-inline">' +
                    '<input type="text" placeholder="Authorization" name="headerKey[]" autocomplete="off" class="layui-input">' +
                    '</div>' +
                    '</div>' +
                    '<div class="layui-inline">' +
                    '<label class="layui-form-label">value</label>' +
                    '<div class="layui-input-inline">' +
                    '<input type="text" placeholder="This is token value" name="headerValue[]" autocomplete="off" class="layui-input">' +
                    '</div>' +
                    '</div>' +
                    '</div>'
                );
                return false;
            });
            // 表单提交
            form.on('submit(confirm)', function (data) {
                $("#submitBtn").attr('disabled', true);
                var loadingLayer = layer.load(1, {
                    shade: [0.1, '#fff'] //0.1透明度的白色背景
                });
                var fields = $(data.form).serializeArray();
                var length = fields.length;
                var requestUrl;
                var requestBody;
                var method;
                var headerKey = new Array();
                var headerValue = new Array();
                for (i = 0; i < length; i++) {
                    switch (fields[i]['name']) {
                        case 'requestUrl':
                            requestUrl = fields[i]['value'];
                            break;
                        case 'headerKey[0]':
                            headerKey.push(fields[i]['value']);
                            break;
                        case 'headerValue[0]':
                            headerValue.push(fields[i]['value']);
                            break;
                        case 'method':
                            method = fields[i]['value'];
                            break;
                        case 'requestBody':
                            requestBody = fields[i]['value'];
                            break;
                    }
                }
                var header = {};
                for (i = 0; i < headerKey.length; i++) {
                    if (headerKey[i] == '' || headerKey[i] == null) {
                        continue;
                    }
                    header[headerKey[i]] = headerValue[i];
                }
                var headerJson = JSON.stringify(header);
                try {
                    $.ajax({
                        headers: (headerJson == '' || headerJson == null) ? {} : JSON.parse(headerJson),
                        type: method,
                        url: requestUrl,
                        data: (requestBody == '' || requestBody == null) ? {} : JSON.parse(requestBody),
                        dataType: "json",
                        success: function (res) {
                            console.log(res)
                            layer.open({
                                type: 1,
                                title: '返回数据',
                                skin: 'layui-layer-demo', //样式类名
                                closeBtn: 0, //不显示关闭按钮
                                anim: 2,
                                area: ['60%', '90%'],
                                shadeClose: true, //开启遮罩关闭
                                content: '<pre>' + syntaxHighlight(JSON.stringify(res)) + '</pre>'
                            });
                        }
                    });
                } catch (error) {
                    console.log(JSON.stringify(error))
                    layer.open({
                        type: 1,
                        title: '请求错误',
                        skin: 'layui-layer-demo', //样式类名
                        closeBtn: 0, //不显示关闭按钮
                        anim: 2,
                        shadeClose: true, //开启遮罩关闭
                        content: JSON.stringify(error)
                    });
                }
                layer.close(loadingLayer);
                $("#submitBtn").removeAttr('disabled');

                return false;
            });

            form.render();
        });

        function updateRadio() {
            layui.use('form', function () {
                var form = layui.form;
                form.render();
            });
        }
        // 请求返回示例内容转换
        $("input[name='requestExample']").each((key, elem) => {
            $("#requestExampleValue" + key).html(syntaxHighlight($(elem).val()));
        });
        $("input[name='returnExample']").each((key, elem) => {
            $("#returnExampleValue" + key).html(syntaxHighlight($(elem).val()));
        });
        function syntaxHighlight(json) {
            if (json == '') {
                return;
            }
            json = JSON.parse(json);
            if (typeof json != 'string') {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json.replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'key';
                    } else {
                        cls = 'string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'boolean';
                } else if (/null/.test(match)) {
                    cls = 'null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        // 类简介展示
        function showClassDesc(content, e) {
            layui.use('layer', function () {
                layer.tips(content, e);
            });
        }

        function openRequestFrame() {
            layui.use('layer', function () {
                layer.open({
                    type: 1,
                    title: "请求测试",
                    skin: 'layui-layer-rim', //加上边框
                    area: ['70%', '80%'], //宽高
                    content: $("#formContent").html()
                });
            });
        }
    </script>
</body>

</html>