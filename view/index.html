<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{{config.title}}</title>
    <link rel="stylesheet" href="{{config.staticUrl.layuiCSSPath}}">
</head>
<style>
    pre {
        padding: 15px;
        margin: 5px;
        font-size: 15px;
        line-height: 23px;
    }

    .string {
        color: red;
    }

    .number {
        color: green;
    }

    .boolean {
        color: blue;
    }

    .null {
        color: yellow;
    }

    .key {
        color: black;
    }
</style>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <!-- 头部信息 -->
        {% include 'unit/header.html' %}
        <!-- 头部信息 -->
        <!-- 右侧导航栏 -->
        {% include 'unit/side.html' %}
        <!-- 右侧导航栏 -->
        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">
                <fieldset class="layui-elem-field layui-field-title">
                    <legend>
                        <h1>
                            {{methodDoc.summary}}
                            {% if methodDoc.rank %}
                            <span class="layui-badge layui-bg-cyan" style="bottom: 10px;">管理员</span> 
                            {% endif %}
                            {% if methodDoc.guest %} 
                            <span class="layui-badge layui-bg-blue" style="bottom: 10px;">游客模式</span> 
                            {% else %} 
                            <span class="layui-badge layui-bg-red" style="bottom: 10px;">用户模式</span> 
                             
                            {% endif %}
                            
                            {% for method in methodDoc.method %}
                            <span class="layui-badge layui-bg-orange" style="bottom: 10px;">{{method}}</span>
                            {% endfor %}
                        </h1>
                    </legend>
                </fieldset>

                <blockquote class="layui-elem-quote">{{requestUrl}}</blockquote>

                {% if methodDoc.description %}
                <fieldset class="layui-elem-field">
                    <legend><h5>描述</h5></legend>
                    <div class="layui-field-box">
                        <pre>{{methodDoc.description}}</pre>
                    </div>
                </fieldset>
                {% endif %}

                <div class="layui-tab layui-tab-card" style="margin-top: 30px;">
                    <ul class="layui-tab-title">
                        <li class="layui-this">
                            请求内容
                        </li>
                        <li>返回内容</li>
                        <li>其他说明</li>
                        <li>变更日志</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <!-- 请求内容 -->
                            {% include 'unit/requestExample.html' %}
                            <!-- 请求内容 -->
                        </div>
                        <div class="layui-tab-item">
                            <!-- 返回内容 -->
                            {% include 'unit/returnExample.html' %}
                            <!-- 返回内容 -->
                        </div>
                        <div class="layui-tab-item">
                            <!-- 其他表格 -->
                            {% include 'unit/table.html' %}
                            <!-- 其他表格 -->
                        </div>
                        <div class="layui-tab-item">
                            <!-- 变更日志 -->
                            {% include 'unit/changeLog.html' %}
                            <!-- 变更日志 -->
                        </div>
                    </div>
                </div>

                {% if methodDoc.link %}
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend><h5>参考链接</h5></legend>
                </fieldset>
                {% for link in methodDoc.link %}
                <blockquote class="layui-elem-quote"><a href="{{link}}" target="_blank">{{link}}</a></blockquote>
                {% endfor %}
                {% endif %}

                <div id="formContent" style="display:none;">
                    <!-- 请求测试 -->
                    {% include 'unit/request.html' %}
                    <!-- 请求测试 -->
                </div>
            </div>
        </div>
        <!-- 底部信息 -->
        {% include 'unit/footer.html' %}
        <!-- 底部信息 -->
    </div>
    <input type="hidden" value="{{methodDoc['example']['requestExample']}}" id="requestExampleVal">
    <input type="hidden" value="{{methodDoc['example']['returnExample']}}" id="returnExampleVal">
    <script src="{{config.staticUrl.jqueryPath}}"></script>
    <script src="{{config.staticUrl.layuiJsPath}}"></script>
    <script>
        // https://www.layui.com/demo/layuiAdmin.html 后台模版示例文档
        //JavaScript代码区域
        layui.use('element', function () {
            var element = layui.element;
        });
        layui.use(['form', 'layer'], function () {
            var form = layui.form;

            // 新增header内容
            form.on('submit(addHeaderSection)', function (data) {
                $(data.form).find("#headerSeparator").before(
                    '<div class="layui-form-item">' +
                    '<div class="layui-inline">' +
                    '<label class="layui-form-label">key</label>' +
                    '<div class="layui-input-inline">' +
                    '<input type="text" placeholder="Authorization" name="headerKey[]" autocomplete="off" class="layui-input">' +
                    '</div>' +
                    '</div>' +
                    '<div class="layui-inline">' +
                    '<label class="layui-form-label">value</label>' +
                    '<div class="layui-input-inline">' +
                    '<input type="text" placeholder="This is token value" name="headerValue[]" autocomplete="off" class="layui-input">' +
                    '</div>' +
                    '</div>' +
                    '</div>'
                );
                return false;
            });
            // 表单提交
            form.on('submit(confirm)', function (data) {
                $("#submitBtn").attr('disabled', true);
                var loadingLayer = layer.load(3, {
                    shade: [0.1, '#fff'] //0.1透明度的白色背景
                });
                var fields = $(data.form).serializeArray();
                var length = fields.length;
                var requestUrl;
                var requestBody;
                var method;
                var headerKey = new Array();
                var headerValue = new Array();
                for (i = 0; i < length; i++) {
                    switch (fields[i]['name']) {
                        case 'requestUrl':
                            requestUrl = fields[i]['value'];
                            break;
                        case 'headerKey[0]':
                            headerKey.push(fields[i]['value']);
                            break;
                        case 'headerValue[0]':
                            headerValue.push(fields[i]['value']);
                            break;
                        case 'method':
                            method = fields[i]['value'];
                            break;
                        case 'requestBody':
                            requestBody = fields[i]['value'];
                            break;
                    }
                }
                var header = {};
                for (i = 0; i < headerKey.length; i++) {
                    if (headerKey[i] == '' || headerKey[i] == null) {
                        continue;
                    }
                    header[headerKey[i]] = headerValue[i];
                }
                var headerJson = JSON.stringify(header);
                try {
                    $.ajax({
                        headers: (headerJson == '' || headerJson == null) ? {} : JSON.parse(headerJson),
                        type: method,
                        url: requestUrl,
                        data: (requestBody == '' || requestBody == null) ? {} : JSON.parse(requestBody),
                        dataType: "json",
                        success: function (res) {
                            console.log(res)
                            layer.open({
                                type: 1,
                                title: '返回数据',
                                skin: 'layui-layer-demo', //样式类名
                                closeBtn: 0, //不显示关闭按钮
                                anim: 2,
                                area: ['60%', '90%'],
                                shadeClose: true, //开启遮罩关闭
                                content: '<pre>' + syntaxHighlight(JSON.stringify(res)) + '</pre>'
                            });
                            layer.close(loadingLayer);
                        }
                    });
                } catch (error) {
                    layer.close(loadingLayer);
                    console.log(JSON.stringify(error))
                    layer.open({
                        type: 1,
                        title: '请求错误',
                        skin: 'layui-layer-demo', //样式类名
                        closeBtn: 0, //不显示关闭按钮
                        anim: 2,
                        shadeClose: true, //开启遮罩关闭
                        content: JSON.stringify(error)
                    });
                }
                $("#submitBtn").removeAttr('disabled');

                return false;
            });

            form.render();
        });

        function updateRadio() {
            layui.use('form', function () {
                var form = layui.form;
                form.render();
            });
        }
        // 请求返回示例内容转换
        $("input[name='requestExample']").each((key, elem) => {
            $("#requestExampleValue" + key).html(syntaxHighlight($(elem).val()));
        });
        $("input[name='returnExample']").each((key, elem) => {
            $("#returnExampleValue" + key).html(syntaxHighlight($(elem).val()));
        });
        function syntaxHighlight(json) {
            if (json == '') {
                return;
            }
            json = JSON.parse(json);
            if (typeof json != 'string') {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json.replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'key';
                    } else {
                        cls = 'string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'boolean';
                } else if (/null/.test(match)) {
                    cls = 'null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        // 类简介展示
        function showClassDesc(content, e) {
            layui.use('layer', function () {
                layer.tips(content, e);
            });
        }

        function openRequestFrame() {
            layui.use('layer', function () {
                layer.open({
                    type: 1,
                    title: "请求测试",
                    skin: 'layui-layer-rim', //加上边框
                    area: ['70%', '80%'], //宽高
                    content: $("#formContent").html()
                });
            });
        }
    </script>
</body>

</html>